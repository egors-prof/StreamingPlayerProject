<!DOCTYPE html>
<html>
<head>
    <title>AudioContext Example</title>
</head>
<body>
<button onclick="playAudio()">Play Audio</button>
<input type="file" id="audioFile" accept="audio/*">

<script>
    // Create audio context
    let audioContext;
    let audioBuffer;
    let sourceNode;

    // Initialize audio context on user interaction
    function initAudioContext() {
        if (!audioContext) {
            audioContext = new (window.AudioContext || window.webkitAudioContext)();
        }
    }

    // Play audio from a URL or local file
    async function playAudio() {
        initAudioContext();

        try {
            // Resume audio context if it was suspended
            if (audioContext.state === 'suspended') {
                await audioContext.resume();
            }

            // Stop any currently playing audio
            if (sourceNode) {
                sourceNode.stop();
            }

            // Fetch and decode audio
            const response = await fetch('https://assets.mixkit.co/music/preview/mixkit-tech-house-vibes-130.mp3');
            const arrayBuffer = await response.arrayBuffer();
            audioBuffer = await audioContext.decodeAudioData(arrayBuffer);

            // Create and configure source
            sourceNode = audioContext.createBufferSource();
            sourceNode.buffer = audioBuffer;
            sourceNode.connect(audioContext.destination);

            // Play audio
            sourceNode.start(0);

            console.log('Audio playing...');

        } catch (error) {
            console.error('Error playing audio:', error);
        }
    }

    // Handle file upload
    document.getElementById('audioFile').addEventListener('change', async (event) => {
        const file = event.target.files[0];
        if (!file) return;

        initAudioContext();

        try {
            const arrayBuffer = await file.arrayBuffer();
            audioBuffer = await audioContext.decodeAudioData(arrayBuffer);

            // Stop any currently playing audio
            if (sourceNode) {
                sourceNode.stop();
            }

            // Create and play source
            sourceNode = audioContext.createBufferSource();
            sourceNode.buffer = audioBuffer;
            sourceNode.connect(audioContext.destination);
            sourceNode.start(0);

            console.log('Playing uploaded file...');

        } catch (error) {
            console.error('Error loading file:', error);
        }
    });
</script>
</body>
</html>